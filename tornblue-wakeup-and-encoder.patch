From b3b6c025f3013bdef3281c70b55eab798dfa5b95 Mon Sep 17 00:00:00 2001
From: Claude <noreply@anthropic.com>
Date: Tue, 17 Feb 2026 11:46:33 +0000
Subject: [PATCH] fix(tornblue): add wakeup-source and migrate encoder to
 modern API

- Add `wakeup-source` property to kscan0 in tornblue.dtsi so the board
  can wake from deep sleep via keypress. Without this, CONFIG_ZMK_SLEEP
  requires USB connection to recover. This matches standard practice in
  upstream boards (Corne, Lily58, Sofle).

- Migrate left encoder from deprecated `resolution = <4>` to the modern
  `steps = <60>` + `triggers-per-rotation = <15>` API. The EVQWGD001
  has 15 detents per rotation (60 electrical steps). Users can override
  `triggers-per-rotation` in their keymap to tune sensitivity.
---
 app/boards/rtitmuss/tornblue/tornblue.dtsi                  | 1 +
 app/boards/rtitmuss/tornblue/tornblue_left_nrf52840_zmk.dts | 3 ++-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/app/boards/rtitmuss/tornblue/tornblue.dtsi b/app/boards/rtitmuss/tornblue/tornblue.dtsi
index 14fd130..ce19029 100644
--- a/app/boards/rtitmuss/tornblue/tornblue.dtsi
+++ b/app/boards/rtitmuss/tornblue/tornblue.dtsi
@@ -45,6 +45,7 @@ RC(2,0) RC(2,1) RC(3,2) RC(1,3) RC(1,4) RC(1,5)  RC(1,6) RC(1,7) RC(1,8) RC(3,9)

     kscan0: kscan {
         compatible = "zmk,kscan-gpio-matrix";
+        wakeup-source;

         diode-direction = "col2row";
     };
diff --git a/app/boards/rtitmuss/tornblue/tornblue_left_nrf52840_zmk.dts b/app/boards/rtitmuss/tornblue/tornblue_left_nrf52840_zmk.dts
index 562cc73..3427d64 100644
--- a/app/boards/rtitmuss/tornblue/tornblue_left_nrf52840_zmk.dts
+++ b/app/boards/rtitmuss/tornblue/tornblue_left_nrf52840_zmk.dts
@@ -30,12 +30,13 @@
             compatible = "alps,ec11";
             a-gpios = <&gpio0 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
             b-gpios = <&gpio0 10 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
-            resolution = <4>;
+            steps = <60>;
     };

     sensors {
             compatible = "zmk,keymap-sensors";
             sensors = <&left_encoder>;
+            triggers-per-rotation = <15>;
     };

     leds {
--
2.43.0
